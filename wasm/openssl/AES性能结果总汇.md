# AES 加解密性能测试结果总汇

## 原因

因为最近项目在做和加密相关的项目，涉及包含服务端、客户端、web端均需要使用AES 多模加密算法对数据进行频繁加密。因为需要大量加密数据，所以为了保证项目没有性能影响，对可能使用的加密方案进行了性能测试。

## 测试硬件

- 主机

	MacBook Pro
	
- cpu

	6-Core Intel Core i7 2.2 GHz/启动超线程
	
- 内存

	16 GB
	
- 磁盘

	ssd
			
## 测试软件

- 服务端
	- openssl
		- openssl 版本LibreSSL 2.8.3
	- golang 加密库
		- 使用原生 golang 自带加密库 `crypto`
- web 端
	- js 加密库
		- AES：
			- 第三方库：asmcrypto.js
					github: https://github.com/asmcrypto/asmcrypto.js
					版本：v2.3.2
			- RSA-ECC:  jsrsasign
					版本：10.0.0
					github: https://github.com/kjur/jsrsasign
	- openssl wasm 
		- openssl 版本 `openssl 1.1.0l`
		- wasmer 1.0.0-alpha4
		
    - 浏览器
        - 版本 85.0.4183.121（正式版本） （64 位） 
       
## 测试方法

分别对 100/300/500 MB 进行多次加密解密，得到均值结果。注意，这里有些模式并不是标准的，所以没有全部模拟，仅供参考。
## 测试结果

### PC 端测试

- Openssl 

	- 加密
	
		| 模式/文件大小    | 100M  |   300M  |  500M | key数据大小 |
		|  ----  | ----  |   ----  | ----- |----  | 
		| ECB  | 0.197s |   0.970s | 1.418s | 128bit  |
		| CBC  | 0.244s |   1.421s | 1.278s | 128bit  |
		| CTR  | 0.203s |   0.587s | 1.145s | 128bit  |
		| GCM  | 0.303s |   1.123s | 1.710s | 128bit  |
		
	- 解密
	
		|  模式/文件大小   | 100M  |   300M  |  500M | key数据大小 |
		|  ----  | ----  |   ----  | ----- |----  | 
		| ECB  | 0.309s |  1.014s   | 1.275s |128bit  |
		| CBC  | 0.260s |   0.946s  | 1.630s |128bit  |
		| CTR  | 0.322s |   1.081s  | 1.591s |128bit  |
		| GCM  | 0.429s |   1.283s | 1.842s | 128bit  |
		
- openssl.wasm

	- 加密
		
		| 模式/文件大小    | 100M  |   300M  |  500M | key数据大小 |
		|  ----  | ----  |   ----  | ----- |----  | 
		| ECB  | 1.775s |   5.326s | 8.996s | 128bit  |
		| CBC  | 1.805s |   5.563s | 9.452s | 128bit  |
		| CTR  | 2.011s |   6.133s | 10.350s | 128bit  |
		
	- 解密
	
		| 模式/文件大小    | 100M  |   300M  |  500M | key数据大小 |
		|  ----  | ----  |   ----  | ----- |----  | 
		| ECB  | 1.894s |   5.780s | 9.186s | 128bit  |
		| CBC  | 1.880s |   5.892s | 10.123s | 128bit  |
		| CTR  | 2.168s |   6.297s | 11.424s | 128bit  |
- Golang
	- 加密
	
		|  模式/文件大小   | 100M  |   300M  |  500M | key数据大小 |
		|  ----  | ----  |   ----  | ----- |----  | 
		| ECB  | 0.258s |   0.789s | 2.752s | 128bit  |
		| CBC  | 0.225s |   1.104s | 1.900s | 128bit  |
		| CTR  | 0.227s |   0.763s | 2.438s | 128bit  |
		| GCM  | 0.109s |   0.381s | 0.786s | 128bit  |
		| CCM  | 0.483s |   1.754s | 2.670s | 128bit  |
	- 解密
	
		|  模式/文件大小   | 100M  |   300M  |  500M | key数据大小 |
		|  ----  | ----  |   ----  | ----- |----  |
		| ECB  | 0.327s |   0.750s  | 0.902s |128bit  |
		| CBC  | 0.241s |   0.613s  | 1.509s |128bit  |
		| CTR  | 0.180s |   0.883s  | 1.274s |128bit  |
		| GCM  | 0.83s  |   0.259s  | 1.166s |128bit  |
		| CCM  | 0.433s |   1.374s  | 2.403s |128bit  |
- JS

	- 加密

		| 模式/文件大小    | 100M  |   300M  | 500M |
		|  ----  | ----  |   ----  | ----- |
		| CBC  | 2.286s | 5.950s | 9.858s |
		| CTR  | 2.188s | 6.315s | 10.445s |
		| ECB  | 2.183s | 6.350s |9.882s |
		| CCM  | 3.777s | 11.561s|18.570s |
		CCM 1M	| 4.235s| 13.635s|21.058s|
		CCM 5M	| 3.978s| 12.247s|20.833s|
		CCM 10M| 4.042s| 11.651s|19.139s|
		CCM 50M| 3.999s| 11.379s|19.162s|
		CCM 100M| 3.848s| 11.316s| 20.410s|
		CCM 300M| | 13.067s| 20.958s|
		
	- 解密

		| 模式/文件大小    | 100M  |   300M  |  500M |
		|  ----  | ----  |   ----  | ----- |
		| CBC  | 1.936s |   6.970s | 11.801s | 
		| CTR  | 2.025s |   6.900s | 12.123s | 
		| ECB  | 2.082s |   6.789s | 11.673s | 
		| CCM  | 3.739s |   10.521s |19.800s | 
		CCM 1M	| 3.869s| 	10.582s| 18.029s| 
		CCM 5M	| 3.860s| 	10.560s| 18.697s| 
		CCM 10M| 3.897s| 10.695s| 19.044s| 
		CCM 50M| 3.938s| 	10.566s| 18.002s| 
		CCM 100M| 3.978s| 10.489s| 18.664s| 
		CCM 300M| | 10.803s| 20.503s| 

### 移动端
- JS
	- 加密

		|  模式/文件大小   | 100M  |   300M  |  500M |
		|  ----  | ----  |   ----  | ----- |
		| CBC  | 13.142 |   41.946 | 72.214 |
		| CTR  | 8.844 |   39.363 | 61.045 | 
		| ECB  | 10.874 |   41.905 | 65.266 | 
		| CCM  | 21.829 |   75.026 | 118.638 | 
		CCM 1M|	38.770	|||	
		CCM 5M|	19.553	|||
		CCM 10M|	23.129	|||	
		CCM 50M|	18.006	|||	
		CCM 100M	|16.391|||
		
	- 解密

		|  模式/文件大小   | 100M  |   300M  |  500M |
		|  ----  | ----  |   ----  | ----- |
		| CBC  | 10.572 |   36.347  | 60.459 |
		| CTR  | 11.545 |   32.835  | 39.321 |
		| ECB  | 7.745 |   36.702  | 42.108 |
		| CCM  | 20.608 |   70.372  | 75.159 | 
		CCM 1M	|20.818|||
		CCM 5M	|15.267|||
		CCM 10M|	15.327|||
		CCM 50M|	15.07|||
		CCM 100M|	15.148 |||

注：移动端测试时，300M和500M数据遇到频繁崩溃现象

### 横向对比

按照常规 100MB横向对比

- 加密

	|  模式/100MB   | openssl  |   openssl.wasm  |  golang | js | js.移动
	|  ----  | ----  |   ----  | ----- |  ----  | ----- |
	| ECB  | 0.197s |   1.775s | 0.258s | 2.183s | 10.874
	| CBC  | 0.244s |   1.805s | 0.225s | 2.286s | 13.142
	| CTR  | 0.203s |   2.011s | 0.227s | 2.188s | 8.844
	| CCM  | |   | 0.483s | 3.777s | 21.829
	| CGM  | 0.303s |   | 0.109s | |

![加密横向对比](./images/加密横向对比.jpg)			

- 解密

	|  模式/100MB   | openssl  |   openssl.wasm  |  golang | js | js.移动
	|  ----  | ----  |   ----  | ----- |  ----  | ----- |
	| ECB  | 0.309s |   1.894s  | 0.327s | 2.082s | 7.745
	| CBC  | 0.260s |   1.880s  | 0.241s | 1.936s | 10.572
	| CTR  | 0.322s |   2.168s  | 0.180s | 2.025s | 11.545
	| CCM  | |    | 0.433s | 3.739s | 20.608
	| CGM  | 0.429s |   | 0.83s | |
	
![解密横向对比](./images/解密横向对比.jpg)

### 结论
   
   - 通过数据显示还是openssl原生的加解密算法速度最快，golang加解密速度次之。
   - openssl.wasm和js库的加解密速度差不多，openssl.wasm可能会好那么一点点。
   - 据说目前Wasm 比本地代码执行速度仅慢20％但是事实测试的结果并不是这样的，也有可能是我编译方式出现了问题,如果有需要的话还需要进一步研究。
    
### END